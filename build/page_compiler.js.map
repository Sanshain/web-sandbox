{"version":3,"file":"page_compiler.js","sources":["../source/features/compiler.js","../source/utils/page_generator.js","../source/utils/utils.js","../source/utils/linter.js","../source/ui/ChoiceMenu.js","../source/features/base.js","../source/pageBuilder.js"],"sourcesContent":["//@ts-check\r\n\r\n\r\n\r\n\r\nconst reactCompiler = {\r\n    react: 'https://unpkg.com/react@17/umd/react.production.min.js',\r\n    reactDOM: 'https://unpkg.com/react-dom@17/umd/react-dom.production.min.js',\r\n}\r\n\r\nconst vueCompiler = {\r\n    // vue: \"https://unpkg.com/vue@2.5.17/dist/vue.js\"\r\n    vue: 'https://cdnjs.cloudflare.com/ajax/libs/vue/2.6.14/vue.min.js'\r\n}\r\n\r\nconst preactCompiler = {\r\n    // set: './build/_preact.js',\r\n    // set: '~/build/_preact.js',\r\n\r\n    // preact: 'https://cdnjs.cloudflare.com/ajax/libs/preact/11.0.0-experimental.1/preact.umd.min.js',     // preact\r\n    // hooks: 'https://cdnjs.cloudflare.com/ajax/libs/preact/11.0.0-experimental.1/hooks.umd.min.js',      // hooks\r\n    // compat: 'https://cdnjs.cloudflare.com/ajax/libs/preact/11.0.0-experimental.1/compat.umd.min.js'     // react\r\n\r\n    // set: 'http://127.0.0.1:3000/build/_preact.js',\r\n\r\n    set: document.location.origin + (~document.location.host.indexOf('3000') ? '/build/_preact.js' : '/static/js/compiler_libs/_preact.js'),\r\n}\r\n\r\n\r\nexport const babelCompiler = {\r\n    link: 'https://unpkg.com/@babel/standalone/babel.min.js',\r\n    mode: ' type=\"text/babel\" '\r\n}\r\n\r\n\r\n// export const reactCompilers = [babelCompiler.link, reactCompiler.react, reactCompiler.reactDOM];\r\n\r\n// export const reactCompilers = [\r\n//     preactCompiler.set,\r\n//     babelCompiler.link,\r\n// ];\r\n\r\n// export const reactCompilers = [\r\n//     vueCompiler.vue\r\n// ];\r\n\r\n\r\nexport const compilers = {\r\n    vanile: [],\r\n    preact: [babelCompiler.link].concat(Object.values(preactCompiler)),\r\n    vue: Object.values(vueCompiler),\r\n    react: [babelCompiler.link].concat(Object.values(reactCompiler)),    \r\n};\r\n\r\n\r\nexport const defaultValues = [\r\n    // html\r\n    {\r\n        html: '<h2 onclick=\"greeting(event)\">\\n\\tHello world!\\n</h2>',\r\n        css: 'h2 {\\n\\tcolor: orangered;\\n\\tcursor: pointer; \\n\\tfont-family: arial;\\n}',\r\n        javascript: 'function greeting(event){\\n\\talert(\"greeting!\")\\n}'\r\n    },\r\n    // preact\r\n    {\r\n        html: '<div id=\"root\"></div>',\r\n        css: '#root{\\n\\tcolor: orangered;\\n\\tfont-family: arial;\\n}',\r\n        javascript: \"const name = 'world'; \\nrender(\\n\\t<h1>Hello {name}</h1>, \\n\\tdocument.getElementById('root')\\n);\"\r\n    },\r\n    // vue\r\n    {\r\n        html: '<div id=\"app\">\\n\\t<input type=\"text\" v-on:input=\"setMsg\" />\\n\\t<p>{{msg}}</p>\\n</div>',\r\n        css: '#app { \\n\\tcolor: green; \\n}',\r\n        javascript: \"new Vue({\\n\\tel: '#app', \\n\\tdata: {\\n\\t\\tmsg: 'Hello Vue!'\\n\\t}, \\n\\tmethods: {\\n\\t\\tsetMsg: function(e){\\n\\t\\t\\tthis.msg = e.target.value;\\n\\t\\t}\\n\\t}\\n})\"\r\n    },\r\n    // react\r\n    {\r\n        html: '<div id=\"root\"></div>',\r\n        css: '#root{\\n\\tcolor: red;\\n\\tfont-family: arial;\\n}\\nh1{\\n\\tcursor: pointer;\\n\\tuser-select: none;\\n}',\r\n        // javascript: \"const name = 'world'; \\n\\nReactDOM.render(\\n\\t<h1>Привет, {name}!</h1>, \\n\\tdocument.getElementById('root')\\n);\"\r\n        javascript: \"function App(){\\n\\n\\tconst [count, setCount] = React.useState(0);\\n\" +\r\n                    \"\\n\\treturn <h1 onClick={()=>setCount(count+1)}>\\n\\t\\tClick me: {count}!\\n\\t</h1>;\\n}\\n\\nReactDOM.render(\\n\\t<App/>,\\n\\tdocument.getElementById('root')\\n);\"\r\n    },\r\n]","/**\r\n * initialize global funcs in the sandbox\r\n * \r\n * (обработчики событий, назначенных в атрибутах, должны быть глобальными. Назначаем их глобальными здесь)\r\n * \r\n * @param {*} code \r\n * @returns \r\n */\r\nexport function generateGlobalInintializer(code) {\r\n\r\n    let globalInit = (code.match(/function ([\\w\\d_]+)\\s?\\(/gm) || [])\r\n        .map(it => it.split(' ')[1].replace('(', '').trim())\r\n        .map(it => 'globalThis.' + it + ' = ' + it).join(';\\n');\r\n\r\n    return globalInit;\r\n}\r\n\r\n\r\nexport const isPaired = (/** @type {string} */ tag) => !~['link'].indexOf(tag);","//@ts-check\r\n\r\nimport { playgroundObject } from \"../pageBuilder\";\r\n\r\nexport const commonStorage = sessionStorage;\r\n\r\n/**\r\n * @param {{ (): number; (): any; }} func\r\n * @param {number} delay\r\n */\r\nexport function debounce(func, delay) {\r\n    \r\n    let inAwaiting = false;\r\n\r\n    return function ()\r\n    {\r\n        if (!inAwaiting) {\r\n\r\n            let result = func();\r\n\r\n            inAwaiting = true;\r\n            setTimeout(() => inAwaiting = false, delay);\r\n\r\n            return result;\r\n        }\r\n    };\r\n}\r\n\r\n\r\n\r\n/**\r\n * extracts lang mode from code text\r\n * \r\n * @param {string} code\r\n * @returns {string|null}\r\n */\r\nexport function getLangMode(code)\r\n{\r\n    let langModeMatch = code.match(/\\/\\* ([\\w \\n]+) \\*\\//);\r\n\r\n    return langModeMatch\r\n        ? langModeMatch.pop()\r\n        : null;\r\n}\r\n\r\n\r\n/**\r\n * @param {string} prevName\r\n * @param {string} fullname\r\n * @param {{ find: (arg0: string) => any; getSession: () => string; }} editor\r\n */\r\nfunction renameOccurrences(prevName, fullname, editor) {\r\n    let fileStore = playgroundObject.fileStorage\r\n    fileStore[fullname] = fileStore[prevName];\r\n    delete fileStore[prevName];\r\n\r\n    for (let file in playgroundObject.fileStorage) {\r\n        if (typeof playgroundObject.fileStorage[file] === 'string') {\r\n            playgroundObject.fileStorage[file] = playgroundObject.fileStorage[file].replace(prevName, fullname);\r\n        }\r\n    }\r\n\r\n    let pos = editor.find(prevName + \"'\")\r\n    pos && editor.getSession().replace(pos, fullname + \"'\")\r\n}\r\n","export const html = (/** @type {ReadonlyArray<string>} */ text, /** @type {any[]} */ ...args) => text.reduce((p, n, i) => p + args[i - 1] + n);","//@ts-check\r\n\r\nimport { html } from \"./../utils/linter\";\r\n\r\n\r\n// HTMLElement\r\nexport class ChoiceMenu extends HTMLElement {\r\n\r\n    itemStyle = ' \\\r\n        color: white; \\\r\n        background-color: #666; \\\r\n        padding: 0.1em 1em 0.1em 2em; \\\r\n        margin-top: 1px; \\\r\n        text-align: right; \\\r\n        position: relative; '\r\n\r\n\r\n    /** selected element\r\n     * @type {HTMLElement}\r\n     */\r\n    selectedElement = null;\r\n\r\n    /** checked mark // only for external slot //\r\n     * @type {HTMLElement}\r\n     */\r\n    checkedElement = null;\r\n\r\n    /** ul\r\n     * @type {HTMLUListElement}\r\n     */\r\n    rootElement = null;\r\n\r\n    /** selected info\r\n     * @type {{id: string, metaId: string, value: string}}\r\n     */\r\n    checkInfo = null;\r\n\r\n    /// \r\n    //@ts-ignore\r\n    itemInitialize = (/** @type {HTMLLIElement} */ el) => ((el.onclick = (/** @type {Event} */ e) => this.selectedChanged(e)), el.style = this.itemStyle)\r\n\r\n    // get rootElement() { return this._rootElement; };\r\n    // set rootElement(v) {\r\n    //     console.log(v);\r\n    //     this._rootElement = v;\r\n    // }\r\n\r\n    \r\n    /** \r\n     * @deprecated\r\n     * @type number\r\n     */\r\n    // @ts-ignore    \r\n    get selectedIndex() {\r\n        let index = [].slice.call(this.rootElement.querySelectorAll('li')).indexOf(this.rootElement.querySelector('.selected'));\r\n        return index;\r\n    };\r\n    \r\n\r\n    /**\r\n     * @type string\r\n     */\r\n    // @ts-ignore\r\n    get selectedItem() {\r\n        //@ts-ignore\r\n        // return (this.rootElement.querySelector('.selected') || {}).innerText\r\n        return this.selectedElement.innerText;\r\n    };\r\n\r\n\r\n    constructor() {\r\n        super();\r\n\r\n        /// base vars\r\n\r\n        //@ts-ignore\r\n        const rootElement = document.getElementById('choice-menu').content.cloneNode(true);\r\n        const shadowRoot = this.attachShadow({ mode: 'open' }).appendChild(rootElement);\r\n\r\n\r\n        // tactic vars\r\n\r\n        //\r\n        let menuElement = this.rootElement = this.shadowRoot.querySelector('ul');\r\n\r\n\r\n        // initialization event\r\n        const self = this; this.shadowRoot.addEventListener(\"slotchange\", function (event) {\r\n            //@ts-ignore\r\n            [menuElement] = [self.rootElement] = event.target.assignedElements();\r\n            self.checkedElement = self.shadowRoot.querySelector('.checked');\r\n            [].slice.call(self.rootElement.querySelectorAll('li')).forEach(self.itemInitialize);\r\n        });\r\n\r\n\r\n        // other events:                    \r\n        this.addEventListener('opened', () => this.pickItem(this.selectedElement))\r\n        this.addEventListener('click', this.visibleChanged);\r\n\r\n\r\n        /// only default slot:\r\n        this.rootElement.addEventListener('click', this.selectedChanged)\r\n    }\r\n\r\n\r\n    ///\r\n    visibleChanged() {\r\n\r\n        const self = this;\r\n        const opened = this.rootElement.classList.contains('active');\r\n\r\n        setTimeout(\r\n            () => {\r\n                self.rootElement.classList.toggle('active');\r\n                setTimeout(() => self.checkedElement && self.checkedElement.classList.toggle('active'), +!opened * 200)\r\n            },\r\n            +opened * 150\r\n        );\r\n\r\n        this.dispatchEvent(new CustomEvent(opened ? 'closed' : 'opened', { detail: null }))\r\n    }\r\n\r\n\r\n    /**\r\n     * \r\n     * @param {HTMLElement} element \r\n     */\r\n    pickItem(element) {\r\n        setTimeout(() => {\r\n            // console.log(this.checkedElement);\r\n\r\n            this.checkedElement.style.top = element.offsetTop + this.offsetHeight + 2 + 'px'\r\n            this.checkedElement.style.right = this.rootElement.offsetWidth - 20 + 'px';  // ? + (16 * 4)  \r\n        })\r\n    }\r\n\r\n\r\n\r\n    /**\r\n     * @param {Event} event\r\n     */\r\n    selectedChanged(event) {\r\n        //@ts-expect-error\r\n        if (event.target.tagName === 'li'.toUpperCase()) {\r\n            \r\n            (this.selectedElement || (this.selectedElement = this.rootElement.querySelector('.selected'))) && this.selectedElement.classList.remove('selected');\r\n            //@ts-expect-error\r\n            (this.selectedElement = event.target).classList.add('selected');\r\n\r\n            //@ts-expect-error\r\n            this.checkedElement && this.pickItem(event.target)\r\n\r\n            this.dispatchEvent(new CustomEvent(\"selected_changed\", {\r\n                detail: this.checkInfo = {\r\n                    //@ts-expect-error\r\n                    id: event.target.id,\r\n                    //@ts-expect-error\r\n                    metaId: event.target.dataset.id,\r\n                    //@ts-expect-error\r\n                    value: event.target.innerText,\r\n                }\r\n            }))\r\n        }\r\n    }\r\n\r\n    /**\r\n     * static constructor\r\n     */\r\n    static __contructor = (function () {\r\n        \r\n        document.body.insertAdjacentHTML('afterbegin', html`\r\n            <template id=\"choice-menu\">\r\n                <style>\r\n                    /* slotted need be styled inline */\r\n                    ::slotted(li),\r\n                    li {                \r\n                        color: white;\r\n                        background-color: #666;\r\n                        padding: 0.1em 1em 0.1em 2em;\r\n                        margin-top: 1px;\r\n                        position: relative;\r\n                    }\r\n\r\n                    ::slotted(ul), ul{\r\n                        margin: 0;\r\n                        padding-left: 0;\r\n                        position: absolute;\r\n                        top: 100%;\r\n                        right: .1em;\r\n                        width: max-content;\r\n                        list-style-type: none;\r\n                        transition: .3s;\r\n                        /* display: none; */\r\n                        \r\n                        overflow: hidden;\r\n                        height: 0;\r\n                    }\r\n\r\n                    /* стили применяемые к самому  my-paragraph*/\r\n                    :host {\r\n                        margin: 0em;\r\n                        /* margin-right: 2em; */\r\n                        position: relative;\r\n                    }\r\n\r\n                    ::slotted(.active), .active{\r\n                        /*display: block !important;*/\r\n\r\n                        height: 6em;                        \r\n                        display: block !important;\r\n                    }\r\n\r\n                    .selected::after, .checked{\r\n                        content: '';\r\n                        background: url(/static/images/check_mark.svg) no-repeat;\r\n                        background-size: contain;\r\n                        width: 1em;\r\n                        height: 2em;\r\n                        position: absolute;\r\n                        left: .5em;\r\n                        top: 0.15em;\r\n                    }\r\n\r\n                    .checked{\r\n                        left: auto;\r\n                        /* opacity: 0; */\r\n                        /* transition: opacity .3s ease .3s; */\r\n                        display: none; \r\n                        z-index: 5;\r\n                    }\r\n\r\n                </style>\r\n\r\n                <!-- <slot name=\"text\">My default text</slot> -->\r\n                <div class=\"checked\"></div>\r\n                <slot>\r\n                    <ul>\r\n                        <li class=\"selected\">item 1</li>\r\n                        <li>item 2</li>\r\n                    </ul>\r\n                </slot>\r\n\r\n            </template>\r\n        `);\r\n\r\n    })()\r\n\r\n}\r\n\r\n\r\n","export const modes = [\r\n    'html',\r\n    'css',\r\n    'javascript',\r\n    // 'typescript',\r\n]","// @ts-check\r\n\r\nimport { babelCompiler, compilers } from \"./features/compiler\";\r\nimport { generateGlobalInintializer, isPaired } from \"./utils/page_generator\";\r\nimport { commonStorage, getLangMode } from './utils/utils';\r\n\r\n// TODO REMOVE:\r\nimport { ChoiceMenu } from \"./ui/ChoiceMenu\";\r\nimport { modes as baseModes } from \"./features/base\";\r\n\r\n\r\nexport { compilers, babelCompiler };\r\n\r\n/**\r\n * @type {{editors: any[], iframe: any, curUrl: any, fileStorage: object, modes?: [object?, object?, object?], onfilerename?: Function, onfileRemove?: (name: string) => void}}\r\n */\r\nexport const playgroundObject = {\r\n    editors: [],\r\n    iframe: null,\r\n    curUrl: null,\r\n    fileStorage: { _active: 0 },\r\n    modes: null,\r\n    onfilerename: null,\r\n    onfileRemove: null\r\n}\r\n\r\n\r\n/**\r\n * @param {{ [x: string]: string; }} [attrs]\r\n */\r\nfunction createHtml({ body, style, script, link }, attrs) {\r\n\r\n    // globalThis.__debug && console.log(arguments);\r\n\r\n    const htmlStruct = {\r\n        html: {\r\n            head: {\r\n                style,\r\n                script,\r\n                link\r\n            },\r\n            body\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @param {{ [x: string]: any; html?: { head: { [x: string]: string; script: string; }; body: any; }; }} nodeStruct\r\n     */\r\n    function nodeCreate(nodeStruct) {\r\n\r\n        let html = '';\r\n        for (const key in nodeStruct) {\r\n\r\n            let _attrs = attrs[key] || '';\r\n            let content = typeof nodeStruct[key] === typeof nodeStruct\r\n                ? nodeCreate(nodeStruct[key])\r\n                : (nodeStruct[key] || '');\r\n\r\n            html += content !== null\r\n                ? ('<' + key + _attrs + '>' + content + '</' + key + '>')\r\n                : ('<' + key + _attrs + '/>');\r\n\r\n        }\r\n        return html;\r\n    }\r\n\r\n    return nodeCreate(htmlStruct);\r\n}\r\n\r\n\r\n/**\r\n * \r\n * TODO: option {simplestBundler, fileStore}\r\n * \r\n * @param {string} [prevUrl] - предыдущий URL для освобождения\r\n * @param {string[]} [additionalScripts] - дополнительные скрипты, которые будут добавлены на новую страницу (react, vue, preact...)\r\n * @param {string} [scriptType] - атрибут тега скрипт, который будет добавлен в к тегу script на созданной странице (type=)\r\n * @param {object} [options]\r\n * @returns {[HTMLElement, string]}\r\n */\r\nexport function createPage(prevUrl, additionalScripts, scriptType, options) {\r\n\r\n    // alert(99)\r\n    if ((playgroundObject.fileStorage || window['fileStore']) && playgroundObject.editors) {\r\n        const fileStorage = playgroundObject.fileStorage || window['fileStore'];\r\n        let activeTab = document.querySelector('.tabs .tab.active');\r\n        // update current tab content:\r\n\r\n        if (fileStorage) {\r\n            fileStorage[fileStorage.innerText] = playgroundObject.editors[2].getValue()\r\n        }        \r\n    }\r\n    \r\n    let _fs = (playgroundObject.fileStorage || window['fileStore'] || {});\r\n    let appCode = _fs['app.js'] || _fs['app.ts'] || playgroundObject.fileStorage[undefined + ''];\r\n    // globalThis.__debug && console.log('appCode');\r\n\r\n\r\n    const langMode = getLangMode(appCode);\r\n    if (langMode) {\r\n\r\n        var currentLang = playgroundObject.modes && playgroundObject.modes[2] && playgroundObject.modes[2][langMode];\r\n\r\n        \r\n        if (currentLang && currentLang.src && currentLang.target === 'self') {\r\n\r\n            // currentLang.target === 'self'        /// script ожидает загрузки скрипта на основную страницу\r\n            \r\n            let scriptID = currentLang.src.split('/').pop().split('.').shift();\r\n            let originScript = document.getElementById(scriptID)\r\n            if (!originScript) {\r\n                originScript = document.createElement('script');\r\n                //@ts-ignore\r\n                originScript.src = currentLang.src;\r\n                originScript.id = scriptID;\r\n                originScript.onload = () => {\r\n\r\n                    // createPage(prevUrl, additionalScripts, scriptType, options);\r\n                    waiting.parentElement.removeChild(waiting);\r\n                    if (options && options.onload) {\r\n                        let frameInfo = createPage(prevUrl, additionalScripts, scriptType);\r\n                        options.onload(...frameInfo);\r\n                    }\r\n                }\r\n                document.head.appendChild(originScript);\r\n                let waiting = document.querySelector('.view').appendChild(document.createElement('div'))\r\n                waiting.innerText = 'Ожидание...'\r\n                waiting.id = 'view__waiting';                \r\n                \r\n                if (options && options.onload) {\r\n                    return;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n\r\n    let buildJS = (/** @type {string} */ code) => {        \r\n\r\n        // convert to js:   \r\n\r\n        code = buildAndTranspile(code, currentLang);\r\n\r\n        // \r\n        let globalReinitializer = generateGlobalInintializer(code);\r\n\r\n        code = 'window.addEventListener(\"' + (scriptType ? 'load' : 'DOMContentLoaded') + '\", function(){' + code + '\\n\\n' + globalReinitializer + '\\n});';\r\n\r\n        // customLOG\r\n        const terminalJar = document.querySelector('.console .lines');\r\n        \r\n        if (terminalJar) {\r\n\r\n            terminalJar.innerHTML = '';\r\n\r\n            function loclog(/** @type {string} */ value) {\r\n\r\n                window.parent.postMessage(\r\n                    // { value: typeof value === 'object' ? JSON.stringify(value) : value, type: typeof value },\r\n                    { value, type: typeof value },\r\n                    '*'\r\n                );\r\n                console.log([].slice.call(arguments).join());\r\n            }\r\n\r\n            function onmessage(event) {\r\n                if (typeof event.data == 'string') {\r\n\r\n                    let data = {type: 'string'}\r\n                    try {\r\n                        data.value = globalThis.eval(event.data);\r\n                    }\r\n                    catch (e) {\r\n                        data.value = data.error = '> ' + e.stack.split(':').shift() + ': ' + e.message;\r\n                    }\r\n                    window.parent.postMessage(data, '*')\r\n                }\r\n            }\r\n\r\n            const onmessageFunc = \"window.addEventListener('message', \" + onmessage.toString() + \");\"\r\n\r\n            code = '\\n' + loclog.toString() + '\\n' + onmessageFunc + '\\n\\n' + code.replace(/console\\.(log|warn)/g, 'loclog');\r\n        }        \r\n\r\n        return code;\r\n    }\r\n\r\n\r\n    // при concat все равно скопируется\r\n    // additionalScripts = additionalScripts.slice()\r\n    \r\n    \r\n    const editors = playgroundObject.editors;\r\n    const baseTags = ['body', 'style', 'script'];\r\n    const attrs = {\r\n        script: scriptType\r\n    }\r\n\r\n    // compilerSubModes дополняем:\r\n    if (playgroundObject.modes && playgroundObject.modes.length) playgroundObject.editors.forEach((editor, i) => {\r\n\r\n        /**\r\n         * @type ChoiceMenu\r\n         */\r\n        let modeMenu = editor.container.querySelector('choice-menu');\r\n        if (modeMenu) {\r\n            /**\r\n             * @type {{src: string|string[], target?: {tag: string, attributes: string, inside?: true}}}\r\n             */\r\n            let actualMode = playgroundObject.modes[i][modeMenu.selectedElement.innerText]\r\n            if (actualMode) {                \r\n                // additionalScripts = (additionalScripts || []).concat(typeof actualMode.src === 'string' ? [actualMode.src] : actualMode.src);\r\n                [].slice.call(typeof actualMode.src === 'string' ? [actualMode.src] : actualMode.src).forEach(el => additionalScripts.push(el));\r\n                // дополнительные скрипты. В частности less\r\n                window['__debug'] && console.log(additionalScripts);\r\n            }\r\n            \r\n            if (actualMode && actualMode.target) {\r\n                                                \r\n                /// possibility change style tag to link tag:\r\n                if (actualMode.target.tag) baseTags[i] = actualMode.target.tag;\r\n\r\n                if (actualMode.target.inside) {\r\n\r\n                    // here constructs tags that will involve right to iframe:\r\n                    \r\n                    let blob = new Blob([editors[i].getValue()], { type: 'text/' + baseModes[i] });\r\n                    let link = URL.createObjectURL(blob);\r\n                    // actualMode.target.attributes = actualMode.target.attributes.replace('{}', link)\r\n                    actualMode.target.attributes = actualMode.target.attributes.replace(/href\\=\"[\\:\\w\\d-\\{\\}/\\.]+\"/, 'href=\"' + link + '\"')\r\n                    // window['__debug'] && console.log(baseModes[i]);\r\n                    window['__debug'] && console.log(link);\r\n                    // window['__debug'] && console.log(actualMode.target);\r\n                }\r\n                if (actualMode.target.attributes) attrs[baseTags[i]] = actualMode.target.attributes;\r\n            }\r\n        }\r\n    })\r\n\r\n    \r\n    /// TODO? @import 'style.css' to style html tag from link file?\r\n    \r\n    let htmlContent = baseTags.reduce((acc, el, i, arr) => (\r\n        (\r\n            acc[el] = i < 2\r\n                ? isPaired(el) ? editors[i].getValue() : null\r\n                : buildJS(appCode || editors[i].getValue())\r\n        ), acc),\r\n        {}\r\n    );    \r\n\r\n    let optionalScripts = ''\r\n    if (additionalScripts && additionalScripts.length) {\r\n        for (let i = 0; i < additionalScripts.length; i++) {\r\n            // htmlContent['body'] += '<script src=\"' + additionalScripts[i] + '\"></script>';\r\n            optionalScripts += '<script src=\"' + additionalScripts[i] + '\"></script>';\r\n        }\r\n    }    \r\n    \r\n    window['__debug'] && console.log('htmlContent', htmlContent);\r\n\r\n    let html = createHtml(htmlContent, attrs);\r\n\r\n    globalThis.__debug && console.log(optionalScripts);\r\n    html = html.replace('</head>', optionalScripts + '</head>');\r\n    html = html.replace('<head>', '<head><meta charset=\"UTF-8\">');\r\n\r\n    let file = new Blob([html], { type: 'text/html' });\r\n\r\n    prevUrl && URL.revokeObjectURL(prevUrl);\r\n    let url = URL.createObjectURL(file);\r\n\r\n    let view = document.querySelector('.view');\r\n    playgroundObject.iframe && (playgroundObject.iframe.parentElement === view) && view.removeChild(playgroundObject.iframe);\r\n    // view.innerHTML = '';    \r\n\r\n    let frame = document.createElement('iframe');\r\n    frame.sandbox.add('allow-scripts')\r\n    frame.sandbox.add('allow-modals')\r\n    // frame.sandbox.add('allow-same-origin')\r\n    frame.src = url;\r\n    view.appendChild(frame)\r\n\r\n    return [frame, url]\r\n}\r\n\r\n\r\n/**\r\n * @param {string} code\r\n * @param {{ compileFunc: (arg0: string) => string; }} currentLang\r\n */\r\nfunction buildAndTranspile(code, currentLang) {\r\n    if (window['simplestBundler']) {\r\n        code = window['simplestBundler'].default(code, playgroundObject.fileStorage || window['fileStore']);\r\n        globalThis.__debug && console.log('build...');\r\n    }\r\n    else {\r\n        console.warn('bundler is absent');\r\n        // alert('Warn/ look logs')\r\n    }\r\n\r\n    // ts transpilation:\r\n    if (currentLang && currentLang.compileFunc) {\r\n        code = currentLang.compileFunc(code);\r\n    }\r\n    return code;\r\n}\r\n\r\n/**\r\n * // @param {(url: string) => [HTMLIFrameElement, string]} [createPageFunc]\r\n * @param {boolean} jsxMode ///! param {number} compilerMode\r\n * @param {string[]} compilerModes - list of script libs to attach to generated page\r\n *\r\n * TODO: options: {storage (localStorage|sessionStorage), fileStore}\r\n * @param {boolean|undefined} [less]\r\n */\r\nexport function webCompile(jsxMode, compilerModes, less) {\r\n\r\n    globalThis.__debug && console.log('compile');\r\n\r\n    // [iframe, curUrl] = createPage(curUrl);\r\n    // globalThis.__debug && console.log(iframe);\r\n\r\n    \r\n\r\n    let iframe = playgroundObject.iframe,\r\n        editors = playgroundObject.editors;\r\n\r\n    const fileStorage = playgroundObject.fileStorage || window['fileStore'];\r\n    //@ts-ignore\r\n    if (Object.keys(fileStorage || {}).length) {\r\n        let activeTab = document.querySelector('.tabs .tab.active');\r\n        //@ts-ignore\r\n        if (activeTab) fileStorage[activeTab.innerText] = editors[2].getValue()\r\n        // else {\r\n        //     fileStorage[undefined + ''] = editors[2].getValue()\r\n        // }\r\n    }\r\n\r\n    if (iframe.contentDocument && less) {\r\n        \r\n        /**\r\n         * attantion: because from deleted scripts, working handlers may remain on the page, which will spoil the picture \r\n         * (it may be safe to change styles only or for frameworks that completely overwrite html). With a full html record , it is quite an option\r\n         */\r\n\r\n        iframe.contentDocument.body.innerHTML = editors[0].getValue()\r\n        iframe.contentDocument.head.querySelector('style').innerHTML = editors[1].getValue()\r\n\r\n        /////// remove last script:\r\n\r\n        let lastScript = [].slice.call(iframe.contentDocument.querySelectorAll('script')).pop();\r\n        lastScript && lastScript.parentElement.removeChild(lastScript);\r\n\r\n        //////// \r\n\r\n        // let lastScripts = iframe.contentDocument.querySelectorAll('script');\r\n        // lastScripts && lastScripts.length && Array.prototype.slice.call(lastScripts).forEach((/** @type {{ parentElement: { removeChild: (arg: any) => void; }; }} */ element) =>\r\n        // {\r\n        //     element.parentElement.removeChild(element);\r\n        // });\r\n        \r\n        /////////\r\n        \r\n        // [].slice.call(document.querySelector('iframe').contentDocument.getElementsByTagName('script')).pop()\r\n\r\n        let script = iframe.contentDocument.createElement('script');\r\n        \r\n        globalThis.__debug && console.log('less compilation')\r\n        globalThis.__debug && console.log(jsxMode)\r\n        globalThis.__debug && console.log(compilerModes);\r\n\r\n        if (jsxMode) {\r\n            \r\n            // add additional scripts:\r\n\r\n            // for (let i = 0; i < compilerMode.length; i++) {\r\n            //     const link = compilerMode[i];\r\n\r\n            //     let jsxCompiler = iframe.contentDocument.createElement('script');\r\n            //     jsxCompiler.src = link;\r\n            //     iframe.contentDocument.body.appendChild(jsxCompiler);\r\n            // }\r\n\r\n            script.type = \"text/babel\";\r\n        }\r\n\r\n        let code = playgroundObject.fileStorage['app.js'] || playgroundObject.fileStorage['app.ts'] || editors[2].getValue();\r\n\r\n        const currentLang = playgroundObject.modes && playgroundObject.modes[2] && playgroundObject.modes[2][getLang()];\r\n        code = buildAndTranspile(code, currentLang);\r\n\r\n        let globalReinitializer = generateGlobalInintializer(code)\r\n\r\n        script.innerHTML = '(function(){' + code + ';\\n\\n' + globalReinitializer + '\\n})()';\r\n        iframe.contentDocument.body.appendChild(script)\r\n        // iframe.contentDocument.head.querySelector('script').innerHTML = editors[2].getValue()\r\n    }\r\n    else {\r\n        // globalThis.__debug && console.log(compilerMode);\r\n        // globalThis.__debug && console.log(Object.values(compilers)[compilerMode]);\r\n        // let [iframe, curUrl] = createPage(playgroundObject.curUrl, Object.values(compilers)[compilerMode], jsxMode ? babelCompiler.mode : undefined);\r\n        let [iframe, curUrl] = createPage(playgroundObject.curUrl, compilerModes, jsxMode ? babelCompiler.mode : undefined);\r\n        playgroundObject.iframe = iframe;\r\n        playgroundObject.curUrl = curUrl;\r\n    }\r\n\r\n\r\n\r\n\r\n    let compiler = Number.parseInt((commonStorage || localStorage).getItem('mode') || '0');\r\n\r\n    // just sandbox feature:\r\n    (commonStorage || localStorage).setItem(compiler + '__html', editors[0].getValue());\r\n    (commonStorage || localStorage).setItem(compiler + '__css', editors[1].getValue());\r\n    (commonStorage || localStorage).setItem(compiler + '__javascript', editors[2].getValue());\r\n    \r\n\r\n\r\n    let modulesStore = {};\r\n\r\n    console.log('save modules...')\r\n\r\n    if (fileStorage && Object.keys(fileStorage).length > 1) {\r\n        \r\n        for (let i = 0; i < Object.keys(fileStorage).length; i++) {\r\n            const fileName = Object.keys(fileStorage)[i];\r\n            if (fileName.startsWith('_')) continue;\r\n            modulesStore[fileName] = fileStorage[fileName];\r\n        }\r\n\r\n        // js multitabs:\r\n        (commonStorage || localStorage).setItem('_modules', JSON.stringify(modulesStore));\r\n        globalThis.__debug && console.log('save modules...');\r\n    }\r\n\r\n    // document.getElementById('compiler_mode')\r\n}\r\n\r\n\r\n\r\nfunction getLang() {\r\n    let fs = (playgroundObject.fileStorage || window['fileStore'] || {});\r\n    let appCode = fs['app.js'] || fs['app.ts'] || playgroundObject.fileStorage[undefined + ''];\r\n    const langMode = getLangMode(appCode);\r\n    return langMode;\r\n}\r\n\r\n"],"names":["preactCompiler","set","document","location","origin","host","indexOf","babelCompiler","link","mode","compilers","vanile","preact","concat","Object","values","vue","react","reactDOM","generateGlobalInintializer","code","match","map","it","split","replace","trim","join","commonStorage","sessionStorage","getLangMode","langModeMatch","pop","html","text","args","reduce","p","n","i","HTMLElement","body","insertAdjacentHTML","modes","playgroundObject","editors","iframe","curUrl","fileStorage","_active","onfilerename","onfileRemove","createPage","prevUrl","additionalScripts","scriptType","options","window","querySelector","innerText","getValue","_fs","appCode","undefined","langMode","currentLang","src","target","scriptID","shift","originScript","getElementById","createElement","id","onload","waiting","parentElement","removeChild","frameInfo","head","appendChild","baseTags","attrs","script","length","forEach","editor","modeMenu","container","actualMode","selectedElement","slice","call","el","push","console","log","tag","inside","blob","Blob","type","baseModes","URL","createObjectURL","attributes","htmlContent","acc","arr","globalReinitializer","buildAndTranspile","terminalJar","loclog","value","parent","postMessage","arguments","onmessage","event","data","globalThis","eval","e","error","stack","message","innerHTML","onmessageFunc","toString","buildJS","optionalScripts","style","nodeCreate","nodeStruct","key","_attrs","content","createHtml","__debug","file","revokeObjectURL","url","view","frame","sandbox","add","default","warn","compileFunc","jsxMode","compilerModes","less","keys","activeTab","contentDocument","lastScript","querySelectorAll","fs","getLang","compiler","Number","parseInt","localStorage","getItem","setItem","modulesStore","fileName","startsWith","JSON","stringify"],"mappings":"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"}