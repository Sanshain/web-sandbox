<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        body{
            margin: 0;
            padding: 0;
        }

        .md_container{
            display: flex;
            flex-direction: row;
            justify-content: space-evenly;     
            flex-wrap: wrap;
            background-color: gray;
        }        

        .editor, .view {
            /* display: inline-block; */
            margin-top: 1em;
            width: calc(50vw - 1em);;
            height: 45vh;
        }

        .view{
            border: 1px gray solid;
            margin-top: .7em;            
            left: -2px;
            position: relative;            
            background-color: #fff;
        }
    </style>
</head>

<body>

    <div class="md_container">
        <div class="editor" id="htmleditor"></div>
        <div class="editor" id="csseditor"></div>
        <div class="editor" id="jseditor"></div>
        <div class="view"></div>
    </div>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.14/ace.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.14/ext-language_tools.min.js"></script>

    <!-- <script src="https://pagecdn.io/lib/ace/1.4.5/ace.js"></script> -->
    <!-- <script src="./ace.js"></script> -->
    <script src="./build/editor.js"></script>
    <script src="./source/ace_initialize.js"></script>

    <script>

        let editors = initializeEditor(ace, ['html', 'css', 'javascript'])
    
        function createHtml({body, style, script}) {

            console.log(arguments);

            const htmlStruct = {
                html: {
                    head: {
                        style,
                        script
                    },
                    body
                }
            }

            function nodeCreate(nodeStruct) {
                
                let html = '';
                for (const key in nodeStruct) {

                    let content = typeof nodeStruct[key] === typeof nodeStruct 
                        ? nodeCreate(nodeStruct[key]) 
                        : nodeStruct[key];

                    html += '<' + key + '>' + content + '</' + key + '>';

                }
                return html;
            }

            return nodeCreate(htmlStruct);

        }

        function createPage(prevUrl) {
            
            let html = createHtml(['body', 'style', 'script'].reduce((acc, el, i, arr) => ((acc[el] = editors[i].getValue()), acc), {}));

            let file = new Blob([html], { type: 'text/html' });
            
            prevUrl && URL.revokeObjectURL(prevUrl);
            let url = URL.createObjectURL(file);

            let view = document.querySelector('.view');
            view.innerHTML = '';

            let frame = document.createElement('iframe');
            frame.src = url;                        
            view.appendChild(frame)

            return [url]
        }

        let curUrl = createPage()

    </script>
</body>

</html>