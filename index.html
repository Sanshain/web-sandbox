<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <link rel="stylesheet" href="./static/css/web-pground.css">
    <link rel="stylesheet" href="./static/css/tabs.css">
    <link rel="stylesheet" href="./static/css/ace_theme.css">

    <style>
        body::-webkit-scrollbar { width: 0; }
        .md_container{
            padding: .3em 0 0;
        }
        .header{
            height: 4em;            
            background-color: gray;
        }

        .h_line{
            top: calc(44vh + 2.8em);            
            /* background-color: hotpink; */
        }

        .header select{
            margin: 1em;
            background-color: gray;
            cursor: pointer;            
        }

        


        .settings{
            background     : url(static/images/settings.svg) no-repeat;            
        }

        .expand{
            display: none;
        }

        #view__waiting{
            color: gray;
            text-align: center;
            line-height: 20em;            
            font-family:'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
            width: 100%;
            position: absolute;            
        }






        @media screen and (max-width: 600px) {
            .tabs {
                /* display: none; */
                top: 89.7vh;
                left: 1.5em;               
                max-width: 79.1vw; 
            }

        }

    
    </style>
</head>

<body>    

    <div class="header">

        <select name="compiler_mode" id="compiler_mode">
            <option value="js">js</option>
            <option value="preact" title="^10.6.6">preact</option>
            <option value="vue" title="2.6.14">vue</option>
            <option value="react" title="@17">react</option>            
            <!-- <option value="jsx">jsx</option> -->
        </select>

    </div>

    <div class="md_container">
        
        <div class="editor" id="htmleditor"></div>
        <div class="editor" id="csseditor"></div>

        <hr class="h_line">
        <div class="center_line"></div>
        <div class="v_line"></div>

        <div class="tabs">
            <div class="tab active" tabindex="0">app.js</div>
            <div class="tab">+</div>
            <!-- onclick="fileAttach(event) -->
        </div>
        <div class="editor" id="jseditor"></div>
        <div class="view">            
            <div class="expand" data-title="Expand"></div>
            <div class="console hidden">
                <div class="close" onclick="['.play', '.save'].map(s => document.querySelector(s)).concat(this.parentElement).forEach(el => el && el.classList.toggle('hidden'))">
                    +
                </div>
                <div class="lines"></div>
                <input type="text" list='console__log__list' onkeydown="evalCode(event)" placeholder="Введите выражение для вычислений">
                <div class="send" onclick="evalCode({key: 'Enter', target: this.previousElementSibling})"></div>

                <datalist id='console__log__list'>
                    <!-- <option value="document.querySelector("></option>
                    <option value="document.querySelectorAll("></option> -->
                </datalist>
            </div>
        </div>


        <div class="play" title="RUN (press F9)"></div>
    </div>

    <hr>

    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.14/ace.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.14/ext-language_tools.min.js"></script> -->


    <script src="./static/js/ace.js"></script>
    <script src="./static/js/ext-language_tools.min.js"></script>


    <!-- <script src="https://pagecdn.io/lib/ace/1.4.5/ace.js"></script> -->
    
    <!-- <script src="./ace.js"></script> -->
    <!-- <script src="./build/editor.js"></script> -->
    <!-- <script src="./source/ace_initialize.js"></script> -->

    <!-- must have some params for initialization: 1 - preact (and other) relative path, 2 - height for size change line calculation -->



    <script src="./build/bundler.js"></script>
    <script src="./build/page_builder.js"></script>    



    <!-- test: -->
    <!-- <script src="./build/_preact.js"></script> -->    
    <!-- <script src="https://unpkg.com/vue@3.2.31/dist/vue.global.js"></script> -->

    <script>

        /**
         * to .close
         */
        // function hideConsole(event) {
        //     event.target.parentElement.classList.toggle('hidden');
        //     ['.play', '.save'].forEach(function (s) { 
        //         let el = document.querySelector(s); 
        //         console.log(el);
        //         el && el.classList.remove('hidden'); 
        //     })

        //     // this.parentElement.classList.toggle('hidden'); ['.play', '.save'].map(s => {let el = document.querySelector(s); el && el.classList.toggle('hidden')})
        //     // ['.play', '.save'].map(s => document.querySelector(s)).concat(event.target.parentElement).forEach(el => el && el.classList.toggle('hidden'))
        // }



        __debug = true;

        let editors = IDE.initialize([], {
            // tabAttachSelector: '.tab:last-child',
            tabAttachSelector: '.tab:last-child',
            // additionalFiles: {
            //     'dd.js': 'export var r = 5;'
            // },
            // multitab: {
            //     selector: '.tab:last-child'
            // },
            modes: [
                {
                    html: null,
                },
                {
                    css: null,
                    less: {
                        ext: '.less',
                        src: document.location.origin + '/static/js/preproc/less.min.js',
                        target: {
                            inside: true,                                                         // 'outline'|'external'
                            tag: 'link',
                            attributes: ' rel="stylesheet/less" type="text/css" href="{}" '
                        }
                    }
                },
                Object.assign({
                    javascript: null,
                    'ES module': {
                        tabs: true,
                        mode: 'javascript',
                    },              
                },  
                {
                    typescript: {

                        src: 'https://unpkg.com/typescript@latest/lib/typescriptServices.js',
                        target: 'self',
                        tabs: true,
                        ext: '.ts',
                        compileFunc: code => {                            
                            if (window.ts){
                                let r = ts.transpile(code, {jsx: +sessionStorage.getItem('mode') % 2});
                                return r;
                            }
                            else{
                                console.warn('Something went wrong: ts is undefind...');
                                return code;
                            }
                        }
                    },                    
                })
            ],
            onControlSave: function (event) {
                // alert(99)
            }, 
            onfilerename: function(prevName, name, rnCallback) {
                alert(99)
            },
            onfileRemove: function(name) {
                
            }
        });


        window.addEventListener('DOMContentLoaded', function(event) {
            // document.querySelector('.tabs').style.display = 'block'
            
            // setTimeout(function() {
            //     editors[2].session.$mode.$highlightRules.$keywordList.push("from ")
            // }, 1000)
        })

    </script>

</body>

</html>